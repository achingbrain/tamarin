<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tamarin</title>
    <link rel="stylesheet" type="text/css" href="/theme.css">
</head>
<body>

<header>
    <nav id="menu">
        <a class="home-link" href="/home" data-view="home" title="home">Home</a>
        <a class="widgets-link" href="/widgets" data-view="widgets" title="widgets">Widgets</a>
        <a class="widget-link" href="/widgets/widget-1" data-view="widget" title="widget">Widget-1</a>
        <a class="bad-link" href="/bad">Bad link</a>
    </nav>
    <h1>Hi all</h1>
</header>

<div id="view"></div>

<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/jquery-storage-api/jquery.storageapi.min.js"></script>
<script src="/bower_components/jquery-query-object/jquery.query-object.js"></script>

<script>
    // The following script has been written to simulate dynamic loading of pages
    // as a testbed for the tamarin module and has deliberate delays
    if (location.pathname === '/login' || $.localStorage.get('user')) {
        var view = 'errors'
        $('nav a')
                .on('click', function (e) {
                    e.preventDefault()
                    $('.selected').removeClass('selected')
                    $(e.currentTarget).addClass('selected')
                    setTimeout(function () {
                        location.pathname = $(e.currentTarget).attr('href')
                    }, 250)
                })
                .filter('[href="' + location.pathname + '"]').addClass('selected')
        switch (location.pathname) {
            case '/home':
                view = 'home';
                break;
            case '/login':
                view = 'login';
                break;
            case '/widgets':
                view = 'widgets';
                break;
            case '/widgets/widget-1':
                view = 'widget';
                break;
        }
        document.title += ':' + view
        $('#view').load('/templates/' + view + '.html', function () {
            console.log(view + ': loaded')
        })
    } else {
        location.pathname = '/login?return=' + location.pathname
    }
</script>

</body>
</html>